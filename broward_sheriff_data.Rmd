---
title: "Broward Sheriff Data Comparison"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).



```{r}
library(tidyverse)
library(magrittr)
setwd("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/crim-recid-code")

```

Reading in pretrial prescreen dataset which the Broward Sheriff's Office shared with ProPublica
```{r}
pretrialscreen_2013_2014<-read.csv("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/Data tables/Compas_Jan2013_Dec2014_LegalRequest_PRETRIAL AND PRESCREEN.csv")

pretrialscreen_2014_2017<-read.csv("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/Data tables/Compas_Jan2014_Dec2017_LegalRequest_PRETRIAL AND PRESCREEN.csv")

pretrialscreen<-bind_rows(pretrialscreen_2013_2014,pretrialscreen_2014_2017)
# pretrialscreen$Screening_Date<-as.Date(pretrialscreen$Screening_Date,format="%m/%d/%Y %T")
#the above doesn't work for some reason

rm(pretrialscreen_2013_2014,pretrialscreen_2014_2017)
 
scattertbl1<-filter(pretrialscreen,DisplayText=="Risk of Violence")
scattertbl2<-filter(pretrialscreen,DisplayText=="Risk of Recidivism")
scattertbl3<-filter(pretrialscreen,DisplayText=="Risk of Failure to Appear")

features<-read.csv("features.csv")

```

```{r}
ggplot(pretrialscreen, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Pretrial Prescreen Dataset")

boxplot(RawScore~DisplayText,data=pretrialscreen, main="Distribution of Raw Scores for Each Screening Type", xlab="DisplayText", ylab="RawScore")



print("mean,25th quartile, median, 75th quartile,min,max")
print("Risk of Violence min max raw scores:")
fivenum(scattertbl1$RawScore)


ggplot(scattertbl1, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Scores")

print("Risk of Recidivism min max raw scores:")
fivenum(scattertbl2$RawScore)

ggplot(scattertbl2, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Scores")


print("Risk of Failure to Appear min max raw scores:")
fivenum(scattertbl1$RawScore)

ggplot(scattertbl3, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Scores")



```

Comparison with data from ProPublica, more summary statistics
```{r}
pretrialscreen%>%
        select(LegalStatus)%>%
        unique()

pretrialscreen%>%
        select(AssessmentReason)%>%
        unique()

pretrialscreen%>%
        select(DisplayText)%>%
        unique()


nonprescreen=filter(pretrialscreen,LegalStatus!="Pretrial")
prescreen=filter(pretrialscreen,LegalStatus=="Pretrial")
#compare to people from propublica dataset 

print("min max Screening Dates")
min(pretrialscreen$Screening_Date)
max(pretrialscreen$Screening_Date)


#people who have same raw score, but different decile score. Work with scattertbl3 first, because has integer score values 

# filter(scattertbl3, )

```

LegalStatus
<chr>
1	Conditional Release			
10	Post Sentence			
205	Pretrial			
43143	Other			
4 rows

AssessmentReason
<fctr>
1	Intake			
1 row
 
 
DisplayText
<fctr>
1	Risk of Violence			
2	Risk of Recidivism			
3	Risk of Failure to Appear			
3 rows


Issue: we only have the criminal history information for people in ProPublica's dataset, and ProPublica only looked at pretrial people. Therefore we can only look at the Compas algorithm for pretrial screening (and in fact, we will be looking at the features table I generated in an earlier bit of code)

*Note: p_current_age is age at compas screening  date
*Note: also checking the relationship between the compas score and recidivism (by propublica's definition)
```{r}

ggplot(features, aes(x=p_age, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Age")

ggplot(features, aes(x=p_current_age, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Current Age")

ggplot(features, aes(x=p_age, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Age")

ggplot(features, aes(x=p_current_age, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Current Age")

ggplot(features, aes(x=p_age, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Age")

ggplot(features, aes(x=p_current_age, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Current Age")


```
Find function that models the "lower edge"
From rdoc on top_n: n is the number of rows to return. If x is grouped, this is the number of rows per group. Will include more than n rows if there are ties.
If n is positive, selects the top n rows. If negative, selects the bottom n rows.

```{r}
age_subset=features%>%
           select(person_id, first, last, p_current_age, p_violence_raw)%>%
           filter(p_current_age>18&p_current_age<=70)%>%
           group_by(p_current_age)%>%
              
              arrange(p_violence_raw,.by_group=TRUE)%>%
              top_n(n=-1,wt=p_violence_raw)

#comparing logx, logx and logy, original graph
plot(age_subset$p_current_age, age_subset$p_violence_raw)
 plot(age_subset$p_current_age, log(age_subset$p_violence_raw+5))
plot(log(age_subset$p_current_age), log(age_subset$p_violence_raw+5))

exponential.model <- lm(log(age_subset$p_violence_raw+5)~ age_subset$p_current_age)
    #getting equation of model 1
    # summary(exponential.model)
    cf=exponential.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
    exp_reg=function(x){exp(cf[2]*x+cf[1])-5} #x=age
    
    plot(exp_reg,1,70) #the equation of the exponential regression

# exponential.model2 <- lm(log(age_subset$p_violence_raw+5)~ log(age_subset$p_current_age)) 
# #applying log to both variables
#     #getting equation of model 2
#     summary(exponential.model2)
#     cf2=exponential.model2%>% #cf stands for coefficients
#        coef()%>%
#        as.vector()
#     exp_reg2=function(x){(x^cf2[2])*(exp(cf2[1]))-5}#x=age
    

#plotting the regression line on top of age_subset points
violraw.exponential <- exp(predict(exponential.model,list(Age=age_subset$age)))
# violraw.exponential2 <- exp(predict(exponential.model2,list(Age=age_subset$age)))

plot(age_subset$p_current_age, age_subset$p_violence_raw)
lines(age_subset$p_current_age, violraw.exponential-5,lwd=2, col = "blue", xlab = "Age", ylab = "Violence Raw Score")
# lines(age_subset$p_current_age, violraw.exponential2-5,lwd=2, col = "green", xlab = "Age", ylab = "Violence Raw Score")


#plotting the regression line on top of ALL points
ggplot(features, aes(x=p_current_age, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Regression Line Age vs Violence Score") +
     stat_function(fun = exp_reg, colour="blue") +  
     xlim(18,70)



```

```{r}
 write.csv(select(age_subset, p_current_age, p_violence_raw),"age_violence_score.csv")
```



Subtracting out variables: according to Sheriff's office, factors are age, total priors, prior failures to appear at scheduled court appearances, history of illegal substance use, *mental health, time at previous or prior residences*

Trying to subtract out age from violence score based on regression

*Total misdemeanors and felonys 
```{r}

exp_reg=function(x){exp(cf[2]*x+cf[1])-5} #x=age
features$p_current_age=as.integer(features$p_current_age)
   


for(a in c(48,52,56)){
    no_age=features%>%
              select(person_id, p_current_age, p_felony_count_person,p_misdem_count_person,p_violence_raw)%>%
              filter(p_current_age>=(a-2)&p_current_age<=(a+2))
    
    print(ggplot(no_age, aes(x=p_felony_count_person+p_misdem_count_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs Fel+Misd per Person (age range ",a-2,"-",a+2,")"))
          )
}


for(a2 in c(18,20,22,24,26,28,30)){
    no_age=features%>%
              select(person_id, p_current_age, p_felony_count_person,p_misdem_count_person,p_violence_raw)%>%
              filter(p_current_age==a2)
    
    print(ggplot(no_age, aes(x=p_felony_count_person+p_misdem_count_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs Fel+Misd per Person (age ",a2,")"))
          )
}

for(n in c(0,5,10,15,20,25,30,35)){
    n_felmisdem=features%>%
                filter(p_felony_count_person+p_misdem_count_person>=n&
                         p_felony_count_person+p_misdem_count_person<n+5)
    
    print(ggplot(n_5yrfel, aes(x=p_current_age, y=p_violence_raw)) +
              geom_point(shape=1)  +
              ggtitle(paste0("Risk of Violence Raw by Age, ",n," Fel+Misdem"))
    )
          
}            


```

Seems to be pretty clear relationship b/w violence score raw and number of felonies within five years.
But it feels like the relationship actually gets less clear when I subtract out age. Perhaps do a regression line based only on num fel within 5 yrs? 
*Note: weight 2 actually seems to make the relationship clearer
```{r}
exp_reg=function(x){exp(cf[2]*x+cf[1])-5} #x=age
ggplot(features, aes(x=p_yrs5_felcount_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle("Risk of Violence Raw vs Fel5yrs per Person")
       

for(a in c(48,52,56)){
    no_age=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_violence_raw)%>%
              filter(p_current_age>=(a-2)&p_current_age<=(a+2))
    
    print(ggplot(no_age, aes(x=p_yrs5_felcount_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          xlim(0,10)+
          ylim(-5,-1)+
          ggtitle(paste0("Risk of Violence Raw vs 5yrFel per Person (age range ",a-2,"-",a+2,")"))
          )
}

for(a2 in c(18,19,20,21, 22,24,26,28,30)){
    no_age=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_violence_raw)%>%
              filter(p_current_age==a2)
    
    print(ggplot(no_age, aes(x=p_yrs5_felcount_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs 5yrFel per Person (age ",a2,")"))
          )
}

#Trying to look at the people with 0 5yr felonies and compare their distributions by age. 
#Viewing effect of correcting  by the age_score below
for(n in c(0:5)){
    n_5yrfel=features%>%
                filter(p_yrs5_felcount_person==n)%>%
                mutate(score_no_age=p_violence_raw-exp_reg(p_current_age))
    
    print(ggplot(n_5yrfel, aes(x=p_current_age, y=p_violence_raw)) +
              geom_point(shape=1)  +
              ggtitle(paste0("Risk of Violence Raw by Age, ",n," 5yrFel"))+
              stat_function(fun = exp_reg, aes(colour="red")) 

    )
    print(ggplot(n_5yrfel, aes(x=p_current_age, y=score_no_age)) +
            geom_point(shape=1) +
            ggtitle(paste0("Risk of Violence Raw by Age, ",n," 5yrFel age subtracted"))
          )
}            

#Doing the correction and see if it helps with the graphs "shifting" up and down
for(a3 in c(18,19,20,21,22,24,26,28,30)){
    no_age=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_violence_raw)%>%
              filter(p_current_age==a3)%>%
              mutate(score_no_age=p_violence_raw-exp_reg(p_current_age))
    
    print(ggplot(no_age, aes(x=p_yrs5_felcount_person, y=score_no_age)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs 5yrFel per Person (age ",a2,", subtracted age exp_reg)"))+
          ylim(0,3)
          )
}

#looking at original 
ggplot(features, aes(x=p_yrs5_felcount_person, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle("Risk of Violence Raw vs Fel5yrs per Person")
       
#performing correction with exp_reg and looking at all scores
corrected_5yrfel=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_violence_raw)%>%
              mutate(score_no_age=p_violence_raw-exp_reg(p_current_age))
    
ggplot(corrected_5yrfel, aes(x=p_yrs5_felcount_person, y=score_no_age)) +
        geom_point(shape=1)  +
        ggtitle("Risk of Violence Raw vs 5yrFel per Person, subtracted age exp_reg")

```

Generating model line for corrected 5_yr fel, subtracting it from violence score as well
```{r}
corrected_5yrfel=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_violence_raw)%>%
              mutate(score_no_age=p_violence_raw-exp_reg(p_current_age))

yrs5_fel_subset=corrected_5yrfel%>%
                group_by(p_yrs5_felcount_person)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

fel_linear.model <- lm(yrs5_fel_subset$score_no_age~ yrs5_fel_subset$p_yrs5_felcount_person)
    #getting equation of model 
    summary(fel_linear.model)
    fel_cf=fel_linear.model%>% #cf stands for coefficients
       coef()%>%
      
       as.vector()
    lin_reg=function(x){fel_cf[2]*x+fel_cf[1]} #x=fel counts

violraw.fel_lin <- predict(fel_linear.model,list(felcount=yrs5_fel_subset$p_yrs5_felcount_person))
plot(yrs5_fel_subset$p_yrs5_felcount_person, yrs5_fel_subset$score_no_age)
lines(yrs5_fel_subset$p_yrs5_felcount_person, violraw.fel_lin,lwd=2, col = "blue", xlab = "5yr FelCounts", ylab = "Violence Raw Score")


ggplot(corrected_5yrfel, aes(x=p_yrs5_felcount_person, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg, colour="blue") +
        ggtitle("5yrFel Regression Line vs Violence Score, subtracted age exp_reg")



```


Subtracting out age, 5yrfel, then graphing 5YrMisdem against violence score 
```{r}
ggplot(features, aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle("Risk of Violence Raw vs Misdem5yrs per Person")

#age correction only applied
corrected_5yrmisdem=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_misdem_count_5yrs,p_violence_raw)%>%
              mutate(score_1=p_violence_raw-exp_reg(p_current_age))

ggplot(corrected_5yrmisdem, aes(x=p_misdem_count_5yrs, y=score_1)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Misdem5yrs per Person (no age)")

#both corrections applied
corrected2_5yrmisdem=features%>%
              select(person_id, p_current_age, p_yrs5_felcount_person,p_misdem_count_5yrs,p_violence_raw)%>%
              mutate(score_2=p_violence_raw-exp_reg(p_current_age)-lin_reg(p_yrs5_felcount_person))

ggplot(corrected2_5yrmisdem, aes(x=p_misdem_count_5yrs, y=score_2)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Misdem5yrs per Person (no age, 5yrfel)")

######################
#only looking at misdems less than 30
ggplot(filter(features,p_misdem_count_5yrs<=30), aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle("Risk of Violence Raw vs Misdem5yrs per Person (filtered)")

ggplot(corrected_5yrmisdem%>%filter(p_misdem_count_5yrs<=30), aes(x=p_misdem_count_5yrs, y=score_1)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Misdem5yrs per Person (no age,filtered)")

ggplot(corrected2_5yrmisdem%>%filter(p_misdem_count_5yrs<=30), aes(x=p_misdem_count_5yrs, y=score_2)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Misdem5yrs per Person (no age, 5yrfel,filtered)")

######################
for(a in c(48,52,56)){
    no_age=features%>%
              select(person_id, p_current_age, p_misdem_count_5yrs,p_violence_raw)%>%
              filter(p_current_age>=(a-2)&p_current_age<=(a+2))
    
    print(ggplot(no_age, aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
          geom_point(shape=1)  +
          xlim(0,10)+
          ylim(-5,-1)+
          ggtitle(paste0("Risk of Violence Raw vs Misdem5yrs per Person (age range ",a-2,"-",a+2,")"))
          )
}

for(a2 in c(18,19,20,21, 22,24,26,28,30)){
    no_age=features%>%
              select(person_id, p_current_age, p_misdem_count_5yrs,p_violence_raw)%>%
              filter(p_current_age==a2)
    
    print(ggplot(no_age, aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs 5yrMisdem per Person (age ",a2,")"))
          )
}

#Trying to look at the people with 0Misdem5yrs and compare their distributions by age. 

for(n in c(0:10)){
    n_5yrmisdem=features%>%
                filter(p_misdem_count_5yrs==n)
    
    print(ggplot(n_5yrmisdem, aes(x=p_current_age, y=p_violence_raw)) +
              geom_point(shape=1)  +
              ggtitle(paste0("Risk of Violence Raw by Age, ",n," Misdem5yrs"))
    )
          
} 

```
Subtracting out 2 variables didn't seem to work too well...Try generating a separate regression line for misdem counts 5 yrs? 
Generating model line for corrected 5_yr misdem (NOT subtracting out fel_score)
```{r}
corrected_5yrmisdem=features%>%
              select(person_id, p_current_age, p_misdem_count_5yrs,p_violence_raw)%>%
              filter(p_misdem_count_5yrs<=30)%>%
              mutate(score_no_age=p_violence_raw-exp_reg(p_current_age))

ggplot(corrected_5yrmisdem, aes(x=p_misdem_count_5yrs, y=score_no_age)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Misdem5yrs per Person (no age)")

yrs5_misdem_subset=corrected_5yrmisdem%>%
                group_by(p_misdem_count_5yrs)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

misdem_linear.model <- lm(yrs5_misdem_subset$score_no_age~ yrs5_misdem_subset$p_misdem_count_5yrs)
    #getting equation of model 
    # summary(misdem_linear.model)
    misdem_cf=misdem_linear.model%>% #cf stands for coefficients
       coef()%>%
      
       as.vector()
    lin_reg2=function(x){misdem_cf[2]*x+misdem_cf[1]} #x=misdem counts

violraw.misdem_lin <- predict(misdem_linear.model,list(misdemcount=yrs5_misdem_subset$p_misdem_count_5yrs))
plot(yrs5_misdem_subset$p_misdem_count_5yrs, yrs5_misdem_subset$score_no_age)
lines(yrs5_misdem_subset$p_misdem_count_5yrs, violraw.misdem_lin,lwd=2, col = "blue", xlab = "5yr MisdemCounts", ylab = "Violence Raw Score")


ggplot(corrected_5yrmisdem, aes(x=p_misdem_count_5yrs, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg2, colour="blue") +
        ggtitle("5yrMisdem Regression Line vs Violence Score, subtracted age exp_reg")



```

Checking other variables the Sheriff's office told us were relevant
Failures to appear and risk of violence score
```{r}
exp_reg=function(x){exp(cf[2]*x+cf[1])-5} #x=age

#failure to appear
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2 yrs")


ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2yrs+")

ggplot(features, aes(x=cq_fail_appear_two_plus+cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear Total")

for(a in c(20,24,28,32,36,40,44,48,52,56)){
    no_age=features%>%
              select(person_id, p_current_age, cq_fail_appear_two_yr,p_violence_raw)%>%
              filter(p_current_age>=(a-2)&p_current_age<=(a+2))%>%
              mutate(
                    raw=p_violence_raw)
    # print(no_age)
    print(ggplot(no_age, aes(x=cq_fail_appear_two_yr, y=raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs #Fail_appear_two_yr per Person (age range ",a-2,"-",a+2,")"))
          )
}

for(a2 in c(18,19,20,21,22,24,26,28,30,32,34,36,38,42,46,50)){
    no_age=features%>%
              select(person_id, p_current_age, cq_fail_appear_two_yr,p_violence_raw)%>%
              filter(p_current_age==a2)%>%
              mutate(
                    raw=p_violence_raw)
    
    print(ggplot(no_age, aes(x=cq_fail_appear_two_yr, y=raw)) +
          geom_point(shape=1)  +
          ggtitle(paste0("Risk of Violence Raw vs #Fail_appear_two_yr per Person (age ",a2,")"))
          )
}

```

Seeing if relationship b/w violence score, failure to appear (total) gets clearer if I subtract off all the variable regressions I've calculated, some, only age, etc. 
Decided to work with total failure to appear b/c the distinction b/w 2 yrs and 2yrs+ was something we did for the Arnold Foundation. 
Note: exp_reg-age relation
      lin_reg-5yrfel relation
      lin_reg2-5yrmisdem relation
      
```{r}
#original  failure to appear vs violence score 
#within 2 yrs
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2 yrs")

#2 yrs +
ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2yrs+")

#total
ggplot(features, aes(x=cq_fail_appear_two_plus+cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear Total")

corrected_appear=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-lin_reg(p_yrs5_felcount_person),
                     score_no_age3=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs),
                     score_no_age4=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg2(p_misdem_count_5yrs)
                    )

#age correction only
ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Number Failure to Appear Total (no age)")

#age+5yr fel correction
ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age2)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Number Failure to Appear Total (no age,5yrfel)")

#age+5yr fel +5yr misdem correction
ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age3)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Number Failure to Appear Total (no age,5yrfel,5yrmisdem)")

#age+5yrmisdem correction
ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age4)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Number Failure to Appear Total (no age,5yrmisdem)")


```

Generating failure to appear regression line --again, 

```{r}
#failure to appear
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2 yrs")


ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2yrs+")

ggplot(features, aes(x=cq_fail_appear_two_plus+cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear Total")


corrected_appear=features%>%
              select(person_id, p_current_age, p_misdem_count_5yrs,p_violence_raw,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age))

ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected Total Failures to Appear (no age)")

appear_subset=corrected_appear%>%
                filter(total_fail_appear<=5)%>%
                group_by(total_fail_appear)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

appear_linear.model <- lm(appear_subset$score_no_age~ appear_subset$total_fail_appear)
    #getting equation of model 
     # summary(appear_linear.model)
       appear_cf=appear_linear.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
       
    lin_reg3=function(x){appear_cf[2]*x+appear_cf[1]} #x=failure to appear counts

violraw.appear_lin <- predict(appear_linear.model,list(appearcount=appear_subset$total_fail_appear))
plot(appear_subset$total_fail_appear, appear_subset$score_no_age)
lines(appear_subset$total_fail_appear, violraw.appear_lin,lwd=2, col = "blue", 
      xlab = "Failure to Appear Counts", ylab = "Violence Raw Score")


ggplot(corrected_appear, aes(x=total_fail_appear, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg3, colour="blue") +
        ggtitle("Failure to Appear Regression Line vs Violence Score, subtracted age exp_reg")


```

Performing same sort of analysis on p_drug_count_5yrsNote: exp_reg-age relation
      lin_reg-5yrfel relation
      lin_reg2-5yrmisdem relation
      lin_reg3-total failure to appear relation
      lin_reg4-5yrDrug relation
      
```{r}
#original  5yrDrug vs violence score 
ggplot(features, aes(x=p_drug_count_5yrs, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrDrug")

corrected_drug=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person),
                     
                     score_no_age3=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg2(p_misdem_count_5yrs),
                     
                     score_no_age4=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg3(total_fail_appear),
                     
                     score_no_age5=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)
                    )

#age correction only
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrDrug (no age)")

#age+5yr fel correction
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age2)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrDrug (no age,5yrfel)")

#age+5yr misdem correction
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age3)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrDrug (no age,5yrmisdem)")

#age+total failure to appear correction
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age4)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrDrug (no age,total failure to appear)")

#age+5yr fel +5yr misdem +total failure to appear  correction 
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age5)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrDrug (no age,5yrfel,5yrmisdem, total failure to appear)")



```



Generating 5yrdrug vs age regression line (incorporating 5yrfel, 5yrmisdem, total failure to appear)
```{r}
#drug count 5yrs 
ggplot(features, aes(x=p_drug_count_5yrs, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrDrug")

corrected_drug=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)
                    )
ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected 5yrDrug (no age)")

ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age2)) +
          geom_point(shape=1)  +
          ggtitle("Violence Score vs Corrected 5yrDrug (no age, fel, misdem, failure to appear)")

drug_subset=corrected_drug%>%
                group_by(p_drug_count_5yrs)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

drug_linear.model <- lm(drug_subset$score_no_age~ drug_subset$p_drug_count_5yrs)
     # summary(drug_linear.model)
       drug_cf=drug_linear.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
       
    lin_reg4=function(x){drug_cf[2]*x+drug_cf[1]} #x=5yr drug counts

violraw.drug_lin <- predict(drug_linear.model,list(appearcount=drug_subset$p_drug_count_5yrs))
plot(drug_subset$p_drug_count_5yrs, drug_subset$score_no_age)
lines(drug_subset$p_drug_count_5yrs, violraw.drug_lin,lwd=2, col = "blue", 
      xlab = "5yrDrug Counts", ylab = "Violence Raw Score")


ggplot(corrected_drug, aes(x=p_drug_count_5yrs, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg4, colour="blue") +
        ggtitle("5yrDrug Regression Line vs Violence Score, subtracted age exp_reg")

```


5yrTraffic 
```{r}
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrTraffic")

corrected_traffic=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)
                    )

#age correction only
ggplot(corrected_traffic, aes(x=p_yrs5_trafcount_person, y=score_no_age)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrTraffic (no age)")

#age+5yr fel +5yr misdem +total failure to appear  correction +5yr drug correction
ggplot(corrected_traffic, aes(x=p_yrs5_trafcount_person, y=score_no_age2)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs 5yrTraffic (no age,5yrFel,5yrMisdem, total failure to appear, 5yrDrug)")

```
```{r}
#Traffic count 5yrs 
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrTraffic")

corrected_traffic=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)
                    )


traf_subset=corrected_traffic%>%
                group_by(p_yrs5_trafcount_person)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

traf_linear.model <- lm(traf_subset$score_no_age~ traf_subset$p_yrs5_trafcount_person)
     # summary(traf_linear.model)
       traf_cf=traf_linear.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
       
    lin_reg5=function(x){traf_cf[2]*x+traf_cf[1]} #x=5yr drug counts

violraw.traf_lin <- predict(traf_linear.model,list(appearcount=traf_subset$p_yrs5_trafcount_person))
plot(traf_subset$p_yrs5_trafcount_person, traf_subset$score_no_age)
lines(traf_subset$p_yrs5_trafcount_person, violraw.traf_lin,lwd=2, col = "blue", 
      xlab = "5yrTraffic Counts", ylab = "Violence Raw Score")


ggplot(corrected_traffic, aes(x=p_yrs5_trafcount_person, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg5, colour="blue") +
        ggtitle("5yrTraffic Regression Line vs Violence Score, subtracted age exp_reg")

```


p_prison_visits
```{r}
ggplot(features, aes(x=p_prison_visits, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Prison Visits")

corrected_prison=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_prison_visits,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)
                    )

#age correction only
ggplot(corrected_prison, aes(x=p_prison_visits, y=score_no_age)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Prison Visits (no age)")

#age+5yr fel +5yr misdem +total failure to appear  correction +5yr drug correction
ggplot(corrected_prison, aes(x=p_prison_visits, y=score_no_age2)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Prison Visits (no age,5yrFel,5yrMisdem, total failure to appear, 5yrDrug)")

```

```{r}
#Prison visits: p_prison_visits
ggplot(features, aes(x=p_prison_visits, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Prison Visits")

corrected_prison=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_prison_visits,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)-
                                   lin_reg5(p_yrs5_trafcount_person)
                    )


prison_subset=corrected_prison%>%
                group_by(p_prison_visits)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

prison_linear.model <- lm(prison_subset$score_no_age~ prison_subset$p_prison_visits)
     # summary(prison_linear.model)
       prison_cf=prison_linear.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
       
    lin_reg6=function(x){prison_cf[2]*x+prison_cf[1]} #x=5yr drug counts

violraw.prison_lin <- predict(prison_linear.model,list(appearcount=prison_subset$p_prison_visits))
plot(prison_subset$p_prison_visits, prison_subset$score_no_age)
lines(prison_subset$p_prison_visits, violraw.prison_lin,lwd=2, col = "blue", 
      xlab = "Prison Counts", ylab = "Violence Raw Score")


ggplot(corrected_prison, aes(x=p_prison_visits, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg6, colour="blue") +
        ggtitle("Prison Visits Regression Line vs Violence Score, subtracted age exp_reg")

```


p_jail_visits
```{r}
ggplot(features, aes(x=p_jail_visits, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Jail Visits")

corrected_jail=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_prison_visits,p_jail_visits,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)
                    )

#age correction only
ggplot(corrected_jail, aes(x=p_jail_visits, y=score_no_age)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Jail Visits (no age)")

#age+5yr fel +5yr misdem +total failure to appear  correction +5yr drug correction
ggplot(corrected_jail, aes(x=p_jail_visits, y=score_no_age2)) +
     geom_point(shape=1)  +
     ggtitle("Violence Score vs Jail Visits (no age,5yrFel,5yrMisdem, total failure to appear, 5yrDrug)")

```

```{r}
#Traffic count 5yrs 
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrTraffic")

corrected_traffic=features%>%
              select(person_id, p_current_age, 
                     p_yrs5_felcount_person,p_misdem_count_5yrs,
                     cq_fail_appear_two_yr,cq_fail_appear_two_plus,
                     p_drug_count_5yrs,p_yrs5_trafcount_person,
                     p_violence_raw)%>%
              mutate(total_fail_appear=cq_fail_appear_two_plus+cq_fail_appear_two_yr,
                     score_no_age=p_violence_raw-exp_reg(p_current_age),
                     score_no_age2=p_violence_raw-exp_reg(p_current_age)-
                                   lin_reg(p_yrs5_felcount_person)-
                                   lin_reg2(p_misdem_count_5yrs)-
                                   lin_reg3(total_fail_appear)-
                                   lin_reg4(p_drug_count_5yrs)
                    )


traf_subset=corrected_traffic%>%
                group_by(p_yrs5_trafcount_person)%>%
                arrange(score_no_age,.by_group=TRUE)%>%
                top_n(n=-1,wt=score_no_age)

traf_linear.model <- lm(traf_subset$score_no_age~ traf_subset$p_yrs5_trafcount_person)
     # summary(traf_linear.model)
       traf_cf=traf_linear.model%>% #cf stands for coefficients
       coef()%>%
       as.vector()
       
    lin_reg5=function(x){traf_cf[2]*x+traf_cf[1]} #x=5yr drug counts

violraw.traf_lin <- predict(traf_linear.model,list(appearcount=traf_subset$p_yrs5_trafcount_person))
plot(traf_subset$p_yrs5_trafcount_person, traf_subset$score_no_age)
lines(traf_subset$p_yrs5_trafcount_person, violraw.traf_lin,lwd=2, col = "blue", 
      xlab = "5yrTraffic Counts", ylab = "Violence Raw Score")


ggplot(corrected_traffic, aes(x=p_yrs5_trafcount_person, y=score_no_age)) +
        geom_point(shape=1)  +
        stat_function(fun = lin_reg5, colour="blue") +
        ggtitle("5yrTraffic Regression Line vs Violence Score, subtracted age exp_reg")

```


Categorising based on number of felonies/misdemeanors?
Working with Risk of Violence scores
```{r}
#felonies
ggplot(features, aes(x=p_felony_count_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Felonies")


ggplot(features, aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Felonies in 5 yrs")

#misdemeanors
ggplot(features, aes(x=p_misdem_count_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Misdemeanors")


ggplot(features, aes(x=p_misdem_count_5yrs, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Misdemeanors in 5 yrs")

#drugs
ggplot(features, aes(x=p_drug_count_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Drug")


ggplot(features, aes(x=p_drug_count_5yrs, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Drug in 5 yrs")

#failure to appear
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2 yrs")


ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear in 2yrs+")

ggplot(features, aes(x=cq_fail_appear_two_plus+cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number Failure to Appear Total")



```

Exploring more relations for Risk of Violence
<!-- # A tibble: 7 x 1		# A tibble: 2 x 1		# A tibble: 6 x 1 -->
     marital_status		     sex		              race
              <chr>		   <chr>		             <chr>
1            Single		1   Male		      1 Native American
2           Married		2 Female		      2 Caucasian
3         Separated				              3 African-American
4           Divorced				            4 Hispanic
5 Significant Other				              5 Asian
6           Widowed				              6 Other
7          Unknown				

```{r}
#Risk of Violence vs prison time: p_prison_time
ggplot(features, aes(x=p_prison_time, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Prison Time")

#Risk of Violence vs prison visits: p_prison_visits
ggplot(features, aes(x=p_prison_visits, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Prison Visits")

#Risk of Violence vs jail time: p_jail_time
ggplot(features, aes(x=p_jail_time, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Jail Time")

#Risk of Violence vs jail visits: p_jail_visits
ggplot(features, aes(x=p_jail_visits, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Jail Visits")

#Risk of Violence vs 5yrsTraffic: p_yrs5_trafcount_person
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs 5yrsTraffic")

#Risk of Violence vs Total Traffic: p_traffic_count_person
ggplot(features, aes(x=p_traffic_count_person, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Traffic Count")

#Risk of Violence vs prior violent convictions: cq_violent_conviction
ggplot(features, aes(x=cq_violent_conviction, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Violent Convictions")

#Risk of Violence vs Total Convictions: cq_total_convictions
ggplot(features, aes(x=cq_total_convictions, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Total Convictions")

#Risk of Violence vs Number of Cases: p_numcases
ggplot(features, aes(x=p_numcases, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Number of Cases")

#Risk of Violence  and number of failures to appear in 2 yrs 
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs #Failure to appear in 2 yrs")

#Risk of Violence  and number of failures to appear in 2 yrs plus
ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs #Failure to appear in >2 yrs")

#Risk of Violence  and total number of failures to appear 
ggplot(features, aes(x=cq_fail_appear_two_yr+cq_fail_appear_two_plus, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Total# Failure to appear")

#Risk of Violence  and cq_prior_conviction_F
ggplot(features, aes(x=cq_prior_conviction_F, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Prior Conviction F")


#Risk of violence vs race: p_race
ggplot(features, aes(x=p_race, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Race")

#Risk of violence vs sex: p_sex
ggplot(features, aes(x=p_sex, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Sex")

#Risk of violence vs marital status
ggplot(features, aes(x=p_marital_status, y=p_violence_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Raw vs Marital Status")
```


########################
RISK OF FAILURE TO APPEAR
########################
```{r}
ggplot(features, aes(x=p_fail_to_appear_decile, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Decile")

ggplot(features, aes(x=p_current_age, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Age")

#Risk of failure to appear  and number of failures to appear in 2 yrs 
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs #Failure to appear in 2 yrs")

#Risk of failure to appear  and number of failures to appear in 2 yrs plus
ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs #Failure to appear in >2 yrs")

#Risk of failure to appear  and total number of failures to appear 
ggplot(features, aes(x=cq_fail_appear_two_yr+cq_fail_appear_two_plus, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Total# Failure to appear")


#Risk of failure to appear and 5yrFel
ggplot(features, aes(x=p_yrs5_felcount_person, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs 5yrFel")

#Risk of failure to appear and 5yrMisd
ggplot(features, aes(x=p_misdem_count_5yrs, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs 5yrMisd")

#Risk of failure to appear and 5yrDrug
ggplot(features, aes(x=p_drug_count_5yrs, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs 5yrDrug")

#Risk of Failure to Appear vs 5yrsTraffic: p_yrs5_trafcount_person
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs 5yrsTraffic")

#Risk of Failure to Appear vs Total Traffic: p_traffic_count_person
ggplot(features, aes(x=p_traffic_count_person, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Traffic Count")


#Risk of Failure to Appear vs prison time: p_prison_time
ggplot(features, aes(x=p_prison_time, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Prison Time")

#Risk of Failure to Appear vs prison visits: p_prison_visits
ggplot(features, aes(x=p_prison_visits, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Prison Visits")

#Risk of Failure to Appear vs jail time: p_jail_time
ggplot(features, aes(x=p_jail_time, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Jail Time")

#Risk of Failure to Appear vs jail visits: p_jail_visits
ggplot(features, aes(x=p_jail_visits, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Jail Visits")

#Risk of Failure to Appear vs prior violent convictions: cq_violent_conviction
ggplot(features, aes(x=cq_violent_conviction, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Violent Convictions")

#Risk of Failure to Appear vs Total Convictions: cq_total_convictions
ggplot(features, aes(x=cq_total_convictions, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Total Convictions")

#Risk of Failure to Appear vs Number of Cases: p_numcases
ggplot(features, aes(x=p_numcases, y=p_fail_to_appear_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Raw vs Number of Cases")


```


#####################
RISK OF RECIDIVISM: p_recid_raw
#####################

```{r}
#Risk of Recidivism vs Age: p_current_age
ggplot(features, aes(x=p_current_age, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Current Age")


#Risk of Recidivism vs prison time: p_prison_time
ggplot(features, aes(x=p_prison_time, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Prison Time")

#Risk of Recidivism vs prison visits: p_prison_visits
ggplot(features, aes(x=p_prison_visits, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Prison Visits")

#Risk of Recidivism vs jail time: p_jail_time
ggplot(features, aes(x=p_jail_time, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Jail Time")

#Risk of Recidivism vs jail visits: p_jail_visits
ggplot(features, aes(x=p_jail_visits, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Jail Visits")
##
#Risk of Recidivism vs 5yrsFel: p_yrs5_felcount_person
ggplot(features, aes(x=p_yrs5_felcount_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs 5yrsFel")

#Risk of Recidivism vs Total Fel: p_felony_count_person
ggplot(features, aes(x=p_felony_count_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Fel Count")
##
#Risk of Recidivism vs 5yrsMisdem: p_misdem_count_5yrs
ggplot(features, aes(x=p_misdem_count_5yrs, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs 5yrsMisdem")

#Risk of Recidivism vs Total Misdem: p_misdem_count_person
ggplot(features, aes(x=p_misdem_count_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Misdem Count")
##
#Risk of Recidivism vs 5yrsDrug: p_drug_count_5yrs
ggplot(features, aes(x=p_drug_count_5yrs, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs 5yrsDrug")

#Risk of Recidivism vs Total Drug: p_drug_count_person
ggplot(features, aes(x=p_drug_count_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Drug Count")
##
#Risk of Recidivism vs 5yrsTraffic: p_yrs5_trafcount_person
ggplot(features, aes(x=p_yrs5_trafcount_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs 5yrsTraffic")

#Risk of Recidivism vs Total Traffic: p_traffic_count_person
ggplot(features, aes(x=p_traffic_count_person, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Traffic Count")

#Risk of Recidivism vs prior violent convictions: cq_violent_conviction
ggplot(features, aes(x=cq_violent_conviction, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Violent Convictions")

#Risk of Recidivism vs Total Convictions: cq_total_convictions
ggplot(features, aes(x=cq_total_convictions, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Total Convictions")

#Risk of Recidivism vs Number of Cases: p_numcases
ggplot(features, aes(x=p_numcases, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Number of Cases")

#Risk of Recidivism  and number of failures to appear in 2 yrs:cq_fail_appear_two_yr
ggplot(features, aes(x=cq_fail_appear_two_yr, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs #Failure to appear in 2 yrs")

#Risk of Recidivism  and number of failures to appear in 2 yrs plus: cq_fail_appear_two_plus
ggplot(features, aes(x=cq_fail_appear_two_plus, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs #Failure to appear in >2 yrs")

#Risk of Recidivism  and total number of failures to appear 
ggplot(features, aes(x=cq_fail_appear_two_yr+cq_fail_appear_two_plus, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Total# Failure to appear")

#Risk of Recidivism vs race: p_race
ggplot(features, aes(x=p_race, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Race")

#Risk of Recidivism vs sex: p_sex
ggplot(features, aes(x=p_sex, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Sex")

#Risk of Recidivism vs marital status
ggplot(features, aes(x=p_marital_status, y=p_recid_raw)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Raw vs Marital Status")

```

