---
title: "Broward Sheriff Data Comparison"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).



```{r}
library(tidyverse)
library(magrittr)
setwd("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/crim-recid-code")

```

Reading in pretrial prescreen dataset which the Broward Sheriff's Office shared with ProPublica
```{r}
pretrialscreen_2013_2014<-read.csv("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/Data tables/Compas_Jan2013_Dec2014_LegalRequest_PRETRIAL AND PRESCREEN.csv")

pretrialscreen_2014_2017<-read.csv("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/Data tables/Compas_Jan2014_Dec2017_LegalRequest_PRETRIAL AND PRESCREEN.csv")

pretrialscreen<-bind_rows(pretrialscreen_2013_2014,pretrialscreen_2014_2017)
# pretrialscreen$Screening_Date<-as.Date(pretrialscreen$Screening_Date,format="%m/%d/%Y %T")
#the above doesn't work for some reason

rm(pretrialscreen_2013_2014,pretrialscreen_2014_2017)
 
scattertbl1<-filter(pretrialscreen,DisplayText=="Risk of Violence")
scattertbl2<-filter(pretrialscreen,DisplayText=="Risk of Recidivism")
scattertbl3<-filter(pretrialscreen,DisplayText=="Risk of Failure to Appear")

featurestbl<-read.csv("features.csv")

```

```{r}
ggplot(pretrialscreen, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Pretrial Prescreen Dataset")

boxplot(RawScore~DisplayText,data=pretrialscreen, main="Distribution of Raw Scores for Each Screening Type", xlab="DisplayText", ylab="RawScore")



print("mean,25th quartile, median, 75th quartile,min,max")
print("Risk of Violence min max raw scores:")
fivenum(scattertbl1$RawScore)


ggplot(scattertbl1, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Violence Scores")

print("Risk of Recidivism min max raw scores:")
fivenum(scattertbl2$RawScore)

ggplot(scattertbl2, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Recidivism Scores")


print("Risk of Failure to Appear min max raw scores:")
fivenum(scattertbl1$RawScore)

ggplot(scattertbl3, aes(x=RawScore, y=DecileScore)) +
     geom_point(shape=1)  +
     ggtitle("Risk of Failure to Appear Scores")



```

Comparison with data from ProPublica, more summary statistics
```{r}
pretrialscreen%>%
        select(LegalStatus)%>%
        unique()

pretrialscreen%>%
        select(AssessmentReason)%>%
        unique()

pretrialscreen%>%
        select(DisplayText)%>%
        unique()


nonprescreen=filter(pretrialscreen,LegalStatus!="Pretrial")
prescreen=filter(pretrialscreen,LegalStatus=="Pretrial")
#compare to people from propublica dataset 

print("min max Screening Dates")
min(pretrialscreen$Screening_Date)
max(pretrialscreen$Screening_Date)


#people who have same raw score, but different decile score. Work with scattertbl3 first, because has integer score values 

# filter(scattertbl3, )

```

LegalStatus
<chr>
1	Conditional Release			
10	Post Sentence			
205	Pretrial			
43143	Other			
4 rows

AssessmentReason
<fctr>
1	Intake			
1 row
 
 
DisplayText
<fctr>
1	Risk of Violence			
2	Risk of Recidivism			
3	Risk of Failure to Appear			
3 rows


Age, number of priors, number of misdemeanors, number of felonies, expect a decision tree (scattered bunches on scatterplot)

Plot people with similar criminal histories, plot age vs compas score
Similar: similar number of  priors, similar number of offenses, 

Issue: we only have the criminal history information for people in ProPublica's dataset, and ProPublica only looked at pretrial people. Therefore we can only look at the Compas algorithm for pretrial screening (and in fact, we will be looking at the features table I generated in an earlier bit of code)

```{r}
ggplot(featurestbl, aes(x=age, y=compas_score)) +
     geom_point(shape=1)  +
     ggtitle("Compas Score vs Age")

```


