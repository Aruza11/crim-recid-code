---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

**data visualization dfs
--use name as a parameter**
```{r}
dfnew<-read.csv("C:/Users/Caroline Wang/OneDrive/Duke/Criminal Recidivism/Data tables/dfnew.csv")
```


```{r}
    #check if use of logical operator "or" is correct
    #linear spacing for x axis

case_vis<-function(person,dfnew){
    case=dfnew%>%
         filter(name==person)%>%
         as_data_frame()

    jailtb=case%>%
           distinct(jail_in_custody,jail_out_custody)%>%
           rename(incustody=jail_in_custody, outcustody=jail_out_custody)%>%
           mutate(event="jail")

    prisontb=case%>%
           distinct(prison_in_custody,prison_out_custody)%>%
           rename(incustody=prison_in_custody, outcustody=prison_out_custody)%>%
           mutate(event="prison")
    
    chargetb=case%>%
           distinct(offense_date)%>%
           rename(incustody=offense_date)%>%
           mutate(outcustody=incustody,
                  event="charge")
    #Note: these are not unique charges, these are the unique DAYS cases occured
    #On an events visualization, even if somebody had 20 charges on 1 day, it will still
    #only appear as 1 point so there's no point in doing anything else. 
    
    eventstb=bind_rows(jailtb, prisontb,chargetb)
    eventstb$incustody=as.Date(eventstb$incustody)
    eventstb$outcustody=as.Date(eventstb$outcustody)
    
    vis=ggplot(eventstb, aes(colour=event)) + 
        geom_segment(aes(x=(subset(eventstb,event="prison"|"jail")$incustody),
                         xend=(subset(eventstb,event="prison"|"jail")$outcustody), 
                         y=event, yend=event),size=3)+
        geom_point(aes(x=(subset(eventstb,event="charge")$incustody),y=event))+
        labs(title=person,x="time")+
        scale_x_date(date_breaks="1 year", date_labels="%b %Y")
    
    print(vis)
    distinct(select(case,person_id, case_number,charge, charge_degree, statute, screening_date,
                    offense_date))

}
```

Visualization
```{r}

# person="miguel hernandez"
# person="bilal williams"
# person="edward riddle"
person="aajah herrington"

case_vis(person,dfnew)


```
